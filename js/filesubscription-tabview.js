!function(e){var t={};function n(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(i,a,function(t){return e[t]}.bind(null,a));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/apps/filesubscription/js/",n(n.s=6)}([function(e,t,n){"use strict";var i,a=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},r=function(){var e={};return function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}e[t]=n}return e[t]}}(),s=[];function o(e){for(var t=-1,n=0;n<s.length;n++)if(s[n].identifier===e){t=n;break}return t}function l(e,t){for(var n={},i=[],a=0;a<e.length;a++){var r=e[a],l=t.base?r[0]+t.base:r[0],c=n[l]||0,d="".concat(l," ").concat(c);n[l]=c+1;var u=o(d),f={css:r[1],media:r[2],sourceMap:r[3]};-1!==u?(s[u].references++,s[u].updater(f)):s.push({identifier:d,updater:h(f,t),references:1}),i.push(d)}return i}function c(e){var t=document.createElement("style"),i=e.attributes||{};if(void 0===i.nonce){var a=n.nc;a&&(i.nonce=a)}if(Object.keys(i).forEach((function(e){t.setAttribute(e,i[e])})),"function"==typeof e.insert)e.insert(t);else{var s=r(e.insert||"head");if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(t)}return t}var d,u=(d=[],function(e,t){return d[e]=t,d.filter(Boolean).join("\n")});function f(e,t,n,i){var a=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(e.styleSheet)e.styleSheet.cssText=u(t,a);else{var r=document.createTextNode(a),s=e.childNodes;s[t]&&e.removeChild(s[t]),s.length?e.insertBefore(r,s[t]):e.appendChild(r)}}function p(e,t,n){var i=n.css,a=n.media,r=n.sourceMap;if(a?e.setAttribute("media",a):e.removeAttribute("media"),r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var b=null,m=0;function h(e,t){var n,i,a;if(t.singleton){var r=m++;n=b||(b=c(t)),i=f.bind(null,n,r,!1),a=f.bind(null,n,r,!0)}else n=c(t),i=p.bind(null,n,t),a=function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(n)};return i(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;i(e=t)}else a()}}e.exports=function(e,t){(t=t||{}).singleton||"boolean"==typeof t.singleton||(t.singleton=a());var n=l(e=e||[],t);return function(e){if(e=e||[],"[object Array]"===Object.prototype.toString.call(e)){for(var i=0;i<n.length;i++){var a=o(n[i]);s[a].references--}for(var r=l(e,t),c=0;c<n.length;c++){var d=o(n[c]);0===s[d].references&&(s[d].updater(),s.splice(d,1))}n=r}}}},function(e,t,n){"use strict";function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],i=!0,a=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(i=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==o.return||o.return()}finally{if(a)throw r}}return n}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return a(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}e.exports=function(e){var t=i(e,4),n=t[1],a=t[3];if("function"==typeof btoa){var r=btoa(unescape(encodeURIComponent(JSON.stringify(a)))),s="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(r),o="/*# ".concat(s," */"),l=a.sources.map((function(e){return"/*# sourceURL=".concat(a.sourceRoot||"").concat(e," */")}));return[n].concat(l).concat([o]).join("\n")}return[n].join("\n")}},function(e,t,n){"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n=e(t);return t[2]?"@media ".concat(t[2]," {").concat(n,"}"):n})).join("")},t.i=function(e,n,i){"string"==typeof e&&(e=[[null,e,""]]);var a={};if(i)for(var r=0;r<this.length;r++){var s=this[r][0];null!=s&&(a[s]=!0)}for(var o=0;o<e.length;o++){var l=[].concat(e[o]);i&&a[l[0]]||(n&&(l[2]?l[2]="".concat(n," and ").concat(l[2]):l[2]=n),t.push(l))}},t}},function(e,t,n){"use strict";var i=n(1),a=n.n(i),r=n(2),s=n.n(r)()(a.a);s.push([e.i,'#fileSubscriptionTabView .icon{display:inline-block}#fileSubscriptionTabView .msg{color:#000;font-size:13px;padding:2px;margin-left:5px}#fileSubscriptionTabView .msg.success{color:#fff;background-color:#47a447}#fileSubscriptionTabView .msg.error{color:#fff;background-color:#d2322d}#fileSubscriptionTabView .lasttime{font-size:13px}#fileSubscriptionTabView .itemEntry{display:flex;align-items:center;justify-content:space-between}#fileSubscriptionTabView .itemEntry .entryAvatar,#fileSubscriptionTabView .itemEntry button{width:32px;height:32px;border-radius:50%}#fileSubscriptionTabView .itemEntry .entryAvatarClose{background-color:#ef5350}#fileSubscriptionTabView .itemEntry .entryAvatarOpen{background-color:#8bc34a}#fileSubscriptionTabView .itemEntry .entryAvatarInvaild{background-color:gray}#fileSubscriptionTabView .itemEntry .entryDesc{display:flex;flex-direction:column;padding:8px;line-height:1.2em;overflow:hidden}#fileSubscriptionTabView .itemEntry .entryDesc div{font-size:12.5px;color:var(--color-text-maxcontrast)}#fileSubscriptionTabView .itemEntry button.entryEdit{background-color:inherit;border:none;margin-left:auto;transition:all .05s ease-in-out}#fileSubscriptionTabView .itemEntry button.entryEdit:enabled:hover{background-color:lightgrey}#fileSubscriptionTabView .itemEntry button.entryEdit.rotate{transform:rotate(180deg)}#fileSubscriptionTabView ul{margin-left:32px}#fileSubscriptionTabView ul::after{content:" ";border-bottom:2px solid #e0e0e0;display:block;margin:30px 0;position:relative}#fileSubscriptionTabView ul li{margin-top:25px}#fileSubscriptionTabView ul li>div:first-child{display:flex;align-items:center;margin-bottom:5px}#fileSubscriptionTabView ul li>div:first-child .icon{margin-right:10px}#fileSubscriptionTabView ul textarea{width:100%;resize:vertical;max-height:400px}#fileSubscriptionTabView ul textarea ~ div{display:flex;justify-content:space-between;align-items:center}#fileSubscriptionTabView ul textarea ~ div .setDescr{justify-self:flex-end;margin-left:auto}\n',"",{version:3,sources:["webpack://./css/tabview.scss"],names:[],mappings:"AAAA,+BAIQ,oBAAqB,CAJ7B,8BAOQ,UAAW,CACX,cAAe,CACf,WAAY,CACZ,eAAgB,CAVxB,sCAYY,UAAW,CACX,wBAAyB,CAbrC,oCAgBY,UAAW,CACX,wBAAyB,CAjBrC,mCAqBQ,cAAe,CArBvB,oCAyBQ,YAAa,CACb,kBAAmB,CACnB,6BAA8B,CA3BtC,4FA8BY,UAAW,CACX,WAAY,CACZ,iBAAkB,CAhC9B,sDAkC4B,wBAAyB,CAlCrD,qDAmC2B,wBAAyB,CAnCpD,wDAoC8B,qBAAsB,CApCpD,+CAsCY,YAAa,CACb,qBAAsB,CACtB,WAAY,CACZ,iBAAkB,CAClB,eAAgB,CA1C5B,mDA4CgB,gBAAiB,CACjB,mCAAoC,CA7CpD,qDAiDY,wBAAyB,CACzB,WAAY,CACZ,gBAAiB,CACjB,+BAAgC,CApD5C,mEAqD8B,0BAA2B,CArDzD,4DAuDgB,wBAAyB,CAvDzC,4BA8DQ,gBAAiB,CA9DzB,mCAgEY,WAAY,CACZ,+BAAgC,CAChC,aAAc,CACd,aAAc,CACd,iBAAkB,CApE9B,+BAwEY,eAAgB,CAxE5B,+CA0EgB,YAAa,CACb,kBAAmB,CACnB,iBAAkB,CA5ElC,qDA8EoB,iBAAkB,CA9EtC,qCAoFY,UAAW,CACX,eAAgB,CAChB,gBAAiB,CAtF7B,2CAwFgB,YAAa,CACb,6BAA8B,CAC9B,kBAAmB,CA1FnC,qDA4FoB,qBAAsB,CACtB,gBAAiB",sourcesContent:['#fileSubscriptionTabView {\n\n    /* utilize */\n    .icon {\n        display: inline-block;\n    }\n    .msg {\n        color: #000;\n        font-size: 13px;\n        padding: 2px;\n        margin-left: 5px;\n        &.success {\n            color: #fff;\n            background-color: #47a447;\n        }\n        &.error {\n            color: #fff;\n            background-color: #d2322d;\n        }\n    }\n    .lasttime {\n        font-size: 13px;\n    }\n\n    .itemEntry {\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n\n        .entryAvatar, button {\n            width: 32px;\n            height: 32px;\n            border-radius: 50%;\n        }\n        .entryAvatarClose { background-color: #ef5350; }\n        .entryAvatarOpen { background-color: #8bc34a; }\n        .entryAvatarInvaild { background-color: gray; }\n        .entryDesc {\n            display: flex;\n            flex-direction: column;\n            padding: 8px;\n            line-height: 1.2em;\n            overflow: hidden;\n            div {\n                font-size: 12.5px;\n                color: var(--color-text-maxcontrast);\n            }\n        }\n        button.entryEdit {\n            background-color: inherit;\n            border: none;\n            margin-left: auto;\n            transition: all .05s ease-in-out;\n            &:enabled:hover { background-color: lightgrey; }\n            &.rotate {\n                transform: rotate(180deg);\n            }\n        }\n    }\n\n    ul {\n        // display: none;\n        margin-left: 32px;\n        &::after {\n            content: " ";\n            border-bottom: 2px solid #e0e0e0;\n            display: block;\n            margin: 30px 0;\n            position: relative;\n        }\n\n        li {\n            margin-top: 25px;\n            & > div:first-child {\n                display: flex;\n                align-items: center;\n                margin-bottom: 5px;\n                .icon {\n                    margin-right: 10px;\n                }\n            }\n        }\n\n        textarea {\n            width: 100%;\n            resize: vertical;\n            max-height: 400px;\n            & ~ div {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                .setDescr {\n                    justify-self: flex-end;\n                    margin-left: auto;\n                }\n            }\n\n        }\n    }\n}\n'],sourceRoot:""}]),t.a=s},,,function(e,n,i){"use strict";i.r(n);var a,r=i(0),s=i.n(r),o=i(3),l={insert:"head",singleton:!1};s()(o.a,l),o.a.locals;a=OCA.Files.DetailTabView.extend({id:"fileSubscriptionTabView",className:"tab fileSubscriptionTabView",appId:"filesubscription",getLabel:function(){return t(this.appId,"subscription")},getIcon:function(){return"icon-mail"},template:function(){return'<div class="loading icon-loading-small"></div>\n\t\t\t  <div class="linksWrapper hidden"></div>\n\t\t\t  <button class="reloadLinks hidden">'.concat(t(this.appId,"Reload"),"</button>")},_sectionTemplates:{l10n:function(e){return t("filesubscription",e)},getLinkFail:function(){return"<div>".concat(this.l10n("Unable to get share link"),"</div>")},noLink:function(){return"<div>\n\t\t\t\t".concat(this.l10n('There is no external share link of this resource, please reload after creating an external share link in the "Shareing" tab.'),"</br>\n\t\t\t\t").concat(this.l10n("Note: This application does not support the subscription of internal links."),"\n\t\t\t\t</div>")},notOwner:function(){return"<div>".concat(this.l10n("Not file owner"),"</div>")},$item:function(e){return'<div class="item" share-id='.concat(e,"></div>")},$itemContent_vaild:function(e,t){var n={shareId:t.id,labelName:t.label,isEnabled:e.enabled,entryAvatarCssClass:e.enabled?"entryAvatarOpen":"entryAvatarClose",message:e.message,subscriberNum:e.subscriberNum,buttonDisable:e.subscriberNum>0?"":"disabled",strEntrySubscriberNum:this.l10n("Subscribers"),strEntryEnable:this.l10n(e.enabled?"Enabled":"Disabled"),strEntryTitle:this.l10n("Share Link"),strLiTitleEdit:this.l10n("Notification message"),strLastUpdateOn:this.l10n("Last updated on"),strSave:this.l10n("Save"),strLiTitleMail:this.l10n("Email subscription"),strSend:this.l10n("Send"),strLastEmailOn:this.l10n("Last notified on"),strLiTitleCancel:this.l10n("Cancel subscribers"),strCancel:this.l10n("Cancel"),strLastCancelOn:this.l10n("Last cancelled on")};return e.last_message_time&&(n.lastMessageTime=e.last_message_time),e.last_email_time&&(n.lastEmailTime=e.last_email_time),e.last_cancel_time&&(n.lastCancelTime=e.last_cancel_time),OCA.FileSubscription.Templates["sidebar-vaildItem"](n)},$itemContent_invaild:function(e,t){var n={shareId:e.share_id,labelName:e.share_label,hasLog:t,strEntryTitle:this.l10n("Share Link"),strEntryDeleted:this.l10n("Deleted"),strBtnLog:this.l10n("Download notification log"),strNoLog:this.l10n("There is no notification log for this share link."),strBtnDelete:this.l10n("Delete")};return OCA.FileSubscription.Templates["sidebar-invaildItem"](n)}},canDisplay:function(e){return!(void 0!==e.shareOwnerId||e.shareOwnerI)},render:function(){this.$el.html(this.template()),this._getInitData(),this.delegateEvents({"click button.reloadLinks":"render","click button.entryEdit":"_onEntryEdit","change input[name=subscribable]":"_onSubscrSetting","click button.setDescr":"_onSubscrSetting","click button.sendSubscrMail":"_onSendMailEvent","click button.cancelSubscr":"_onCancelEvent","click button.downloadLog":"_onLogDownloadEvent","click button.deleteLog":"_onLogDeletelEvent"})},_getInitData:function(){var e=this.getFileInfo(),t=e.attributes.id,n="".concat(e.attributes.path,"/").concat(e.attributes.name);$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/")),type:"POST",data:{fileId:t,path:JSON.stringify(n.replace("//","/"))},beforeSend:function(){$(".linksWrapper").hide(),$(".reloadLinks").hide(),$(this.$el).find(".loading").show()}}).done((function(e){var t={data:e};void 0===e.result||e.result||(t={data:null,errorType:"notOwner"}),this._renderInitData(t)})).fail((function(e){this._renderInitData({data:null,errorType:"getLinkFail"})})).always((function(e){$(this.$el).find(".loading").hide()}))},_renderInitData:function(e){var t=$(".linksWrapper");if(!(t.length<1)){t.children().remove();var n=this._sectionTemplates;if(e&&e.data)if(e.data.length<1)t.html(n.noLink());else for(var i in e.data){var a=e.data[i],r=n.$item(a.subscription.share_id),s=".item[share-id=".concat(a.subscription.share_id,"]"),o=a.sharing?n.$itemContent_vaild(a.subscription,a.sharing):n.$itemContent_invaild(a.subscription,a.hasSubscrLog);0===$(s).length&&t.append(r),0===$(s).children().length&&($(s).append(o),$(s).find("button.entryEdit").click())}else"notOwner"===e.errorType?t.html(n.notOwner()):t.html(n.getLinkFail());t.show(),$(".reloadLinks").show()}},_rerenderItemData:function(e){var t=$("div.item[share-id=".concat(e.share_id,"]")),n={id:e.share_id,label:t.find(".itemEntry h5 span").text()},i={enabled:e.enabled,message:e.message,subscriberNum:e.subscriberNum,last_message_time:e.last_message_time,last_email_time:e.last_email_time,last_cancel_time:e.last_cancel_time};t.html(this._sectionTemplates.$itemContent_vaild(i,n))},_onEntryEdit:function(e){var t=$(e.target).closest(".item").attr("share-id");$(".item[share-id=".concat(t,"] ul")).toggle(500),$(".item[share-id=".concat(t,"] .entryEdit")).toggleClass("rotate"),$(".item:not([share-id=".concat(t,"]) ul")).hide(500),$(".item:not([share-id=".concat(t,"]) .entryEdit")).removeClass("rotate")},_onSendMailEvent:function(e){var n=$(e.target).closest(".item").attr("share-id"),i=$(".item[share-id]").find("button, input, textarea"),a=$(e.target).closest("li").find(".msg"),r={status:"",data:{message:""}};$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/mail/update")),type:"POST",data:{shareId:n},beforeSend:function(){i.attr("disabled","disabled"),OC.msg.startAction(a,t(this.appId,"Sending..."))}}).done((function(e){r.status="success",r.data.message=e.data.message;var i=$(".item[share-id=".concat(n,"]")).find(".sendSubscrMail ~ .lasttime");i.find("em").length>0?i.find("em > span").text(e.data.lastEmailTime):i.append("<em>".concat(t(this.appId,"Last notified on")," <span>").concat(e.data.lastEmailTime,"</span></em>"))})).fail((function(e){void 0!==e.responseJSON.data.message&&(r.data.message+=e.responseJSON.data.message)})).always((function(){OC.msg.finishedAction(a,r),i.removeAttr("disabled")}))},_onSubscrSetting:function(e){var n=$(e.target).closest(".item").attr("share-id"),i={enabled:$("#subscribable".concat(n)).is(":checked"),message:$("#versionDescr".concat(n)).val(),updateMessageTime:$(e.target).hasClass("setDescr")},a=$(".item[share-id]").find("button, input, textarea"),r=$(e.target).closest("li").find(".msg"),s={status:"",data:{message:""}};$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/update/").concat(n)),type:"POST",data:{shareId:n,setVal:i},beforeSend:function(){a.attr("disabled","disabled"),OC.msg.startAction(r,t(this.appId,"Setting..."))}}).done((function(e){this._rerenderItemData(e)})).fail((function(e){s.data.message=t(this.appId,"Failed")})).always((function(){OC.msg.finishedAction(r,s),a.removeAttr("disabled")}))},_onCancelEvent:function(e){var n=$(".item[share-id]").find("button, input, textarea");n.attr("disabled","disabled");var i=this;OC.dialogs.confirm(t(this.appId,"The system will send a cancellation notice to subscribers and remove all subscribers."),t(this.appId,"Please confirm the cancellation"),(function(a){if(a){var r=$(e.target).closest("li").find(".msg"),s={status:"",data:{message:""}};$.ajax({context:i,url:OC.generateUrl("/apps/".concat(i.appId,"/cancel")),type:"POST",data:{shareId:$(e.target).closest(".item").attr("share-id")},beforeSend:function(){OC.msg.startAction(r,t(i.appId,"Setting..."))}}).done((function(e){i._rerenderItemData(e)})).fail((function(e){s.data.message=t(i.appId,"Failed"),void 0!==e.responseJSON.message&&(s.data.message+=": ",s.data.message+=e.responseJSON.message)})).always((function(){OC.msg.finishedAction(r,s),n.removeAttr("disabled")}))}else n.removeAttr("disabled")}))},_onLogDownloadEvent:function(e){var n=$(".item[share-id]").find("button, input, textarea");n.attr("disabled","disabled");var i=$(e.target).closest("li").find(".msg"),a={status:"",data:{message:""}},r=$(e.target).closest(".item").attr("share-id");$.ajax({context:this,url:OC.generateUrl("/apps/".concat(this.appId,"/log/").concat(r)),type:"GET",beforeSend:function(){OC.msg.startAction(i,t(this.appId,"Loading..."))}}).done((function(e){void 0!==e.data.path&&(window.location.href=e.data.path),a.status="success",a.data.message="OK"})).fail((function(e){a.data.message=t(this.appId,"Unable to load"),void 0!==e.responseJSON.message&&(a.data.message=e.responseJSON.message)})).always((function(e){OC.msg.finishedAction(i,a),n.removeAttr("disabled")}))},_onLogDeletelEvent:function(e){var n=$(".item[share-id]").find("button, input, textarea");n.attr("disabled","disabled");var i=this;OC.dialogs.confirm(t(this.appId,"The subscription to the shared link will be deleted."),t(this.appId,"Please confirm the removal"),(function(t){if(t){var a=$(e.target).closest(".item").attr("share-id");$.ajax({context:i,url:OC.generateUrl("/apps/".concat(i.appId,"/log/").concat(a)),type:"DELETE"}).done((function(e){$(".item[share-id = ".concat(a,"]")).remove()})).always((function(e){n.removeAttr("disabled"),i.render()}))}else n.removeAttr("disabled")}))}}),OCA.FileSubscription.TabView=a}]);